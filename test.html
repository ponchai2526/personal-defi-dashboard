<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test Dashboard - Personal AI DeFi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.2rem;
        }

        .test-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .test-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .wallet-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }

        .network-selector {
            padding: 12px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
        }

        .connect-button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .connect-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .connect-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .status-box {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .status-box.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-box.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-box.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .result-area {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .test-button {
            padding: 12px 24px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .test-button:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .info-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .info-card p {
            color: #666;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üß™ Test Dashboard</h1>
            <p class="subtitle">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</p>
        </div>

        <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ -->
        <div class="test-section">
            <h2 class="test-title">üì° Connection Status</h2>
            <div class="info-grid">
                <div class="info-card">
                    <h3>üåê Frontend</h3>
                    <p>Vercel: <span id="frontendStatus">Loading...</span></p>
                </div>
                <div class="info-card">
                    <h3>üß† Backend</h3>
                    <p>Replit: <span id="backendStatus">Loading...</span></p>
                </div>
                <div class="info-card">
                    <h3>üîó MetaMask</h3>
                    <p>Status: <span id="metamaskStatus">Loading...</span></p>
                </div>
            </div>
        </div>

        <!-- Wallet Connection -->
        <div class="test-section">
            <h2 class="test-title">ü¶ä Wallet Connection Test</h2>
            <div class="wallet-section">
                <select class="network-selector" id="networkSelector">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢</option>
                    <option value="0x1">Ethereum Mainnet</option>
                    <option value="0x89">Polygon</option>
                    <option value="0x38">BNB Smart Chain</option>
                    <option value="0xa4b1">Arbitrum</option>
                </select>
                <button class="connect-button" id="connectButton" onclick="connectWallet()">
                    <span id="connectButtonText">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask</span>
                </button>
            </div>
            <div id="walletStatus" class="status-box info" style="display: none;">
                <div id="walletStatusText">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>
            </div>
        </div>

        <!-- API Tests -->
        <div class="test-section">
            <h2 class="test-title">üîß API Tests</h2>
            <div>
                <button class="test-button" onclick="testBackendHealth()">
                    üè• Health Check
                </button>
                <button class="test-button" onclick="testNativeBalance()" disabled id="nativeBalanceBtn">
                    üí∞ Native Balance
                </button>
                <button class="test-button" onclick="testAIAnalysis()" disabled id="aiAnalysisBtn">
                    üß† AI Analysis
                </button>
                <button class="test-button" onclick="testNewFeatures()" disabled id="newFeaturesBtn">
                    üÜï New Features
                </button>
            </div>
            <div style="margin-bottom: 10px;">
                <button class="test-button" onclick="copyResults()" style="background: #17a2b8;">
                    üìã Copy Results
                </button>
                <button class="test-button" onclick="clearResults()" style="background: #dc3545;">
                    üóëÔ∏è Clear Results
                </button>
                <button class="test-button" onclick="runAllTests()" style="background: #fd7e14;">
                    üöÄ Run All Tests
                </button>
            </div>
            <div class="result-area" id="testResults">
                <div>üìù Test Results ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...</div>
            </div>
        </div>

        <!-- Debug Info -->
        <div class="test-section">
            <h2 class="test-title">üîç Debug Information</h2>
            <div class="info-grid">
                <div class="info-card">
                    <h3>üìç URLs</h3>
                    <p>
                        <strong>Frontend:</strong> https://personal-defi-dashboard.vercel.app/<br>
                        <strong>Test Page:</strong> https://personal-defi-dashboard.vercel.app/test.html<br>
                        <strong>Backend:</strong> https://replit.com/@ponchai2526/my-python-backend-test
                    </p>
                </div>
                <div class="info-card">
                    <h3>üîë Current State</h3>
                    <p>
                        <strong>Account:</strong> <span id="currentAccount">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span><br>
                        <strong>Network:</strong> <span id="currentNetwork">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö</span><br>
                        <strong>Balance:</strong> <span id="currentBalance">0</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===============================
        // Configuration
        // ===============================
        const BACKEND_URL = "https://838de3bd-02e7-4ba3-8bf0-63ab0412b36f-00-39zqf2mohnweu.pike.replit.dev";
        
        // State
        let currentAccount = null;
        let currentChainId = null;
        
        // Network Config
        const NETWORKS = {
            '0x1': { name: 'Ethereum', symbol: 'ETH' },
            '0x89': { name: 'Polygon', symbol: 'MATIC' },
            '0x38': { name: 'BNB Chain', symbol: 'BNB' },
            '0xa4b1': { name: 'Arbitrum', symbol: 'ETH' }
        };

        // ===============================
        // Initial Status Check
        // ===============================
        document.addEventListener('DOMContentLoaded', function() {
            checkInitialStatus();
        });

        function checkInitialStatus() {
            // Frontend Status
            document.getElementById('frontendStatus').textContent = '‚úÖ Active (Vercel)';
            
            // MetaMask Status
            if (typeof window.ethereum !== 'undefined') {
                document.getElementById('metamaskStatus').textContent = '‚úÖ Detected';
            } else {
                document.getElementById('metamaskStatus').textContent = '‚ùå Not Found';
            }
            
            // Backend Status - Test automatically
            testBackendHealth();
        }

        // ===============================
        // Wallet Connection
        // ===============================
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                showWalletStatus('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á MetaMask', 'error');
                return;
            }

            try {
                document.getElementById('connectButtonText').textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...';
                
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                if (accounts.length === 0) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏°‡∏µ account');
                }

                currentAccount = accounts[0];
                currentChainId = await window.ethereum.request({
                    method: 'eth_chainId'
                });

                // Update UI
                updateWalletInfo();
                showWalletStatus('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                
                // Enable API test buttons
                document.getElementById('nativeBalanceBtn').disabled = false;
                document.getElementById('aiAnalysisBtn').disabled = false;
                document.getElementById('newFeaturesBtn').disabled = false;
                
                document.getElementById('connectButtonText').textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';

            } catch (error) {
                console.error('Connection error:', error);
                showWalletStatus(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
                document.getElementById('connectButtonText').textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask';
            }
        }

        function updateWalletInfo() {
            const network = NETWORKS[currentChainId];
            document.getElementById('currentAccount').textContent = `${currentAccount.substring(0, 6)}...${currentAccount.substring(-4)}`;
            document.getElementById('currentNetwork').textContent = network ? network.name : `Unknown (${currentChainId})`;
        }

        function showWalletStatus(message, type) {
            const statusBox = document.getElementById('walletStatus');
            const statusText = document.getElementById('walletStatusText');
            
            statusBox.className = `status-box ${type}`;
            statusText.textContent = message;
            statusBox.style.display = 'block';
        }

        // ===============================
        // API Tests
        // ===============================
        function logTest(message, type = 'info') {
            const resultsArea = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#17a2b8';
            
            resultsArea.innerHTML += `
                <div style="color: ${color}; margin-bottom: 5px;">
                    [${timestamp}] ${message}
                </div>
            `;
            resultsArea.scrollTop = resultsArea.scrollHeight;
        }

        // ===============================
        // Utility Functions
        // ===============================
        function copyResults() {
            const resultsArea = document.getElementById('testResults');
            const textContent = resultsArea.innerText;
            
            // Create a temporary textarea
            const textarea = document.createElement('textarea');
            textarea.value = textContent;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            // Show feedback
            const timestamp = new Date().toLocaleTimeString();
            resultsArea.innerHTML += `
                <div style="color: #28a745; margin-bottom: 5px; font-weight: bold;">
                    [${timestamp}] üìã Results copied to clipboard! ‚úÖ
                </div>
            `;
            resultsArea.scrollTop = resultsArea.scrollHeight;
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '<div>üìù Test Results ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...</div>';
            logTest('üóëÔ∏è Results cleared');
        }

        function runAllTests() {
            logTest('üöÄ Running all tests...');
            logTest('üìä Starting comprehensive test suite...');
            
            // Always run health check first
            testBackendHealth();
            
            // Run wallet-dependent tests if connected
            if (currentAccount && currentChainId) {
                setTimeout(() => testNativeBalance(), 2000);
                setTimeout(() => testAIAnalysis(), 4000);
                setTimeout(() => testNewFeatures(), 6000);
            } else {
                logTest('‚ö†Ô∏è Wallet not connected. Some tests will be skipped.', 'error');
                setTimeout(() => testNewFeatures(), 2000);
            }
            
            setTimeout(() => {
                logTest('üéâ All tests completed!', 'success');
                logTest('üìã You can now copy the results using the Copy Results button', 'success');
            }, 8000);
        }

        async function testBackendHealth() {
            logTest('üè• Testing Backend Health...');
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/health`);
                const data = await response.json();
                
                if (response.ok) {
                    logTest('‚úÖ Backend Health: OK', 'success');
                    logTest(`üìä Response: ${JSON.stringify(data, null, 2)}`);
                    document.getElementById('backendStatus').textContent = '‚úÖ Online (Replit)';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                logTest(`‚ùå Backend Health: ${error.message}`, 'error');
                document.getElementById('backendStatus').textContent = '‚ùå Offline';
            }
        }

        async function testNativeBalance() {
            if (!currentAccount || !currentChainId) {
                logTest('‚ùå Please connect wallet first', 'error');
                return;
            }

            logTest('üí∞ Testing Native Balance...');
            
            try {
                const response = await fetch(
                    `${BACKEND_URL}/api/get_advanced_dashboard?address=${currentAccount}&chainId=${currentChainId}`
                );
                
                if (response.ok) {
                    const data = await response.json();
                    const balance = data.native_token?.data?.balance || 0;
                    const symbol = data.native_token?.data?.symbol || 'TOKEN';
                    
                    logTest(`‚úÖ Native Balance: ${balance.toFixed(6)} ${symbol}`, 'success');
                    document.getElementById('currentBalance').textContent = `${balance.toFixed(6)} ${symbol}`;
                    logTest(`üìä Full Response: ${JSON.stringify(data, null, 2)}`);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP ${response.status}`);
                }
            } catch (error) {
                logTest(`‚ùå Native Balance: ${error.message}`, 'error');
            }
        }

        async function testAIAnalysis() {
            if (!currentAccount || !currentChainId) {
                logTest('‚ùå Please connect wallet first', 'error');
                return;
            }

            logTest('üß† Testing AI Analysis...');
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/get_ai_recommendation`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå portfolio ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏´‡∏ô‡πà‡∏≠‡∏¢",
                        portfolio: {
                            wallet_address: currentAccount,
                            chain_id: currentChainId
                        }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    logTest('‚úÖ AI Analysis: OK', 'success');
                    logTest(`üß† AI Response: ${data.recommendation}`, 'success');
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP ${response.status}`);
                }
            } catch (error) {
                logTest(`‚ùå AI Analysis: ${error.message}`, 'error');
            }
        }

        async function testNewFeatures() {
            logTest('üÜï Testing New Features...');
            
            // Test 1: ERC-20 Token Balances
            logTest('üìù Test 1: ERC-20 Token Balances (Future)');
            logTest('‚ÑπÔ∏è This feature will be implemented in Phase 1');
            
            // Test 2: NFT Collections
            logTest('üìù Test 2: NFT Collections (Future)');
            logTest('‚ÑπÔ∏è This feature will be implemented in Phase 2');
            
            // Test 3: Enhanced AI
            logTest('üìù Test 3: Enhanced AI Analysis (Future)');
            logTest('‚ÑπÔ∏è This feature will be implemented in Phase 3');
            
            logTest('‚úÖ New Features: Ready for Implementation', 'success');
        }

        // ===============================
        // MetaMask Event Listeners
        // ===============================
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', function(accounts) {
                if (accounts.length === 0) {
                    location.reload();
                } else {
                    currentAccount = accounts[0];
                    updateWalletInfo();
                    logTest(`üîÑ Account changed: ${currentAccount.substring(0, 10)}...`);
                }
            });

            window.ethereum.on('chainChanged', function(chainId) {
                currentChainId = chainId;
                updateWalletInfo();
                logTest(`üîÑ Network changed: ${NETWORKS[chainId]?.name || chainId}`);
            });
        }

        // ===============================
        // Initialize
        // ===============================
        logTest('üöÄ Test Dashboard initialized');
        logTest('üí° Click buttons above to test different features');
    </script>
</body>
</html>
