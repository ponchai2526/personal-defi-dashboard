<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal DeFi Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.0/web3.min.js"></script>
    <style>
        /* CSS ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß Dashboard */
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Wallet */
        .wallet-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .connect-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .wallet-info {
            display: none;
            margin-top: 20px;
        }

        .wallet-address {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            color: #00d4ff;
            word-wrap: break-word; /* ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Address ‡πÑ‡∏°‡πà‡∏•‡πâ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á */
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á Dashboard ‡∏´‡∏•‡∏±‡∏Å */
        .dashboard {
            display: none; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ */
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .portfolio-overview {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .portfolio-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #00d4ff;
            margin-bottom: 10px;
        }

        .change-positive {
            color: #00ff88;
        }

        .change-negative {
            color: #ff4757;
        }

        /* ‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á/‡∏à‡∏≥‡∏•‡∏≠‡∏á */
        .real-data {
            color: #00d4ff;
        }

        .mock-data {
            color: #ff8c42;
        }

        .data-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .indicator-real {
            background-color: #00d4ff;
            box-shadow: 0 0 6px #00d4ff;
        }

        .indicator-mock {
            background-color: #ff8c42;
            box-shadow: 0 0 6px #ff8c42;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á Token Holdings */
        .tokens-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tokens-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .tokens-table th,
        .tokens-table td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tokens-table th {
            background: rgba(255, 255, 255, 0.05);
            font-weight: bold;
            color: #00d4ff;
        }

        .token-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 10px;
            vertical-align: middle;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏£‡∏≤‡∏ü */
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 400px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏¢‡πà‡∏≠ */
        .stats-grid {
            display: none; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ */
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-label {
            color: #aaa;
            margin-top: 5px;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô Loading */
        .loading {
            text-align: center;
            padding: 20px;
            color: #00d4ff;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .tokens-table {
                font-size: 14px;
            }

            .header h1 {
                font-size: 2em;
            }
        }

        .network-badge {
            background: linear-gradient(45deg, #8247e5, #3d52a0);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô DeFi Positions */
        .defi-positions {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .position-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #00d4ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Personal DeFi Dashboard</h1>
            <p>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Portfolio ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏ô Polygon Network</p>
            <div class="legend">
                <div class="legend-item">
                    <div class="data-indicator indicator-real"></div>
                    <span class="real-data">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Blockchain</span>
                </div>
                <div class="legend-item">
                    <div class="data-indicator indicator-mock"></div>
                    <span class="mock-data">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Demo</span>
                </div>
            </div>
        </div>

        <div class="wallet-section">
            <h2>üîó ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Wallet</h2>
            <button class="connect-btn" id="connectWalletBtn">
                Connect MetaMask
            </button>
            <div class="wallet-info" id="walletInfo">
                <p><strong>Connected Address:</strong></p>
                <div class="wallet-address real-data" id="walletAddress"></div>
                <p><strong>Network:</strong> <span class="real-data">Polygon Mainnet</span> <span class="network-badge">MATIC</span></p>
            </div>
        </div>

        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Portfolio...</p>
        </div>

        <div class="dashboard" id="dashboard">
            <div class="portfolio-overview">
                <h2>üí∞ Portfolio Overview</h2>
                <div class="portfolio-value" id="portfolioValue">$0.00 <span class="data-source-indicator real-data-label"></span></div>
                <div class="change" id="portfolioChange"></div>
                <div style="margin-top: 15px;">
                    <div><strong>Total Tokens:</strong> <span id="totalTokens">0</span> <span class="data-source-indicator real-data-label"></span></div>
                    <div><strong>Last Updated:</strong> <span class="real-data" id="lastUpdate"></span></div>
                </div>
            </div>

            <div class="chart-container">
                <h2>üìà Portfolio Chart</h2>
                <div class="chart-wrapper">
                    <canvas id="portfolioChart"></canvas>
                </div>
            </div>
        </div>

        <div class="tokens-section" id="tokensSection" style="display: none;">
            <h2>ü™ô Token Holdings</h2>
            <p style="font-size: 14px; color: #aaa; margin-bottom: 15px;">
                <span class="data-indicator indicator-real"></span>
                <span class="real-data">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Polygon Network (‡∏ú‡πà‡∏≤‡∏ô Backend)</span>
            </p>
            <table class="tokens-table">
                <thead>
                    <tr>
                        <th>Token</th>
                        <th>Balance</th>
                        <th>Price</th>
                        <th>Value</th>
                        <th>24h Change</th>
                    </tr>
                </thead>
                <tbody id="tokensTableBody">
                    <tr><td colspan="5" style="text-align: center; color: #ccc;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Token Holdings (‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Wallet ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î)</td></tr>
                </tbody>
            </table>
        </div>

        <div class="stats-grid" id="statsGrid" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="stablecoinsValue">$0.00 <span class="data-source-indicator real-data-label"></span></div>
                <div class="stat-label">Stablecoins</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="altcoinsValue">$0.00 <span class="data-source-indicator real-data-label"></span></div>
                <div class="stat-label">Altcoins</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="ethDerivativesValue">$0.00 <span class="data-source-indicator real-data-label"></span></div>
                <div class="stat-label">MATIC & Derivatives</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="numTokens">0 <span class="data-source-indicator real-data-label"></span></div>
                <div class="stat-label">Total Tokens</div>
            </div>
        </div>

        <div class="defi-positions" id="defiPositions" style="display: none;">
            <h2>üè¶ DeFi Positions</h2>
            <p style="font-size: 14px; color: #aaa; margin-bottom: 15px;">
                <span class="data-indicator indicator-real"></span>
                <span class="real-data">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å API (‡∏ú‡πà‡∏≤‡∏ô Backend)</span>
            </p>
            <div id="defiPositionsContent">
                <div class="position-item">
                    <h3>üí∞ Lending Positions</h3>
                    <p class="real-data">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Lending...</p>
                </div>
                <div class="position-item">
                    <h3>üîÑ Liquidity Pools</h3>
                    <p class="real-data">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Liquidity Pools...</p>
                </div>
                <div class="position-item">
                    <h3>üéØ Yield Farming</h3>
                    <p class="real-data">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Yield Farming...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.0/web3.min.js"></script> <script>
        let web3;
        let userAccount;
        let portfolioChart;
        let isRealDataLoaded = false;

        const BACKEND_URL = "https://838de3bd-02e7-4ba3-8bf0-63ab0412b36f-00-39zqf2mohnweu.pike.replit.dev"; 

        // Mock data ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞ Fallback)
        const mockTokenDataFallback = [
            { symbol: 'USDC', name: 'USD Coin', balance: '1.87814', price: 1.00, value: 1.87, change24h: -0.00, icon: 'https://cryptologos.cc/logos/usd-coin-usdc-logo.png' },
            { symbol: 'POL', name: 'Polygon', balance: '9.46293', price: 0.185, value: 1.75, change24h: 1.90, icon: 'https://cryptologos.cc/logos/polygon-matic-logo.png' },
            { symbol: 'WETH', name: 'Wrapped Ethereum', balance: '0.00024', price: 2583.33, value: 0.62, change24h: 2.66, icon: 'https://cryptologos.cc/logos/ethereum-eth-logo.png' }
        ];

        let currentTokenData = []; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Token ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≥‡∏•‡∏≠‡∏á)

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask Wallet
         */
        async function connectWallet() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ MetaMask Extension ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ MetaMask
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    userAccount = accounts[0]; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠

                    // Initialise Web3.js ‡∏î‡πâ‡∏ß‡∏¢ Provider ‡∏Ç‡∏≠‡∏á MetaMask
                    web3 = new Web3(window.ethereum);

                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Chain ID ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Polygon Mainnet (Chain ID: 137)
                    const chainId = await web3.eth.getChainId();
                    if (Number(chainId) !== 137) { // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ chainId ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
                        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Polygon Mainnet (Chain ID: 137) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Portfolio ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
                        try {
                            // ‡∏•‡∏≠‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏´‡πâ MetaMask ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Network ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Polygon Mainnet
                            await window.ethereum.request({
                                method: 'wallet_switchEthereumChain',
                                params: [{ chainId: web3.utils.toHex(137) }], // Chain ID 137 ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Hex
                            });
                            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à MetaMask ‡∏à‡∏∞‡∏™‡πà‡∏á Event 'chainChanged' ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ reload ‡∏´‡∏ô‡πâ‡∏≤
                        } catch (switchError) {
                            console.error("Error switching network:", switchError);
                            // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Network ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                            if (switchError.code === 4902) {
                                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö Polygon Mainnet ‡πÉ‡∏ô MetaMask ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° Network ‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                            } else if (switchError.code === 4001) {
                                alert('‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Network ‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
                            }
                            return; // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡πâ‡∏≤ Network ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
                        }
                    }

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    document.getElementById('walletAddress').textContent = userAccount;
                    document.getElementById('walletInfo').style.display = 'block';
                    document.getElementById('connectWalletBtn').textContent = 'Connected ‚úÖ'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏∏‡πà‡∏°
                    document.getElementById('connectWalletBtn').disabled = true; // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°

                    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Portfolio ‡∏à‡∏≤‡∏Å Blockchain (‡∏ú‡πà‡∏≤‡∏ô Backend Proxy)
                    await loadPortfolioData();

                } catch (error) {
                    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask
                    console.error('Error connecting to MetaMask:', error);
                    if (error.code === 4001) { // User rejected request
                        alert('‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask ‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
                    } else {
                        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask: ' + error.message);
                    }
                }
            } else {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á MetaMask Extension ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Dashboard ‡∏ô‡∏µ‡πâ');
            }
        }

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Portfolio ‡∏à‡∏≤‡∏Å Backend Server (Replit Backend) ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤
         */
        async function loadPortfolioData() {
            // ‡πÅ‡∏™‡∏î‡∏á Spinner ‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô Dashboard ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
            document.getElementById('loading').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('tokensSection').style.display = 'none';
            document.getElementById('statsGrid').style.display = 'none';
            document.getElementById('defiPositions').style.display = 'none';

            try {
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏à‡∏≤‡∏Å Backend (Replit) ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á Token Balances
                // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡πà‡∏á wallet address ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÉ‡∏´‡πâ Backend
                const response = await fetch(`${BACKEND_URL}/api/wallet_data?address=${userAccount}`);
                if (!response.ok) {
                    // ‡∏ñ‡πâ‡∏≤ Backend ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢ Error
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                currentTokenData = data.tokens; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ currentTokenData ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Backend

                isRealDataLoaded = true; // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Flag ‡∏ß‡πà‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                populateTokensTable(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á Token
                updatePortfolioOverview(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° Portfolio
                createPortfolioChart(); // ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü
                updateStatsGrid(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏¢‡πà‡∏≠
                fetchDeFiPositions(); // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• DeFi Positions (‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Backend Proxy ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ)

            } catch (error) {
                console.error('Error fetching real data from backend:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Portfolio ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Backend ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Backend ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô, Alchemy API Key ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á, ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÅ‡∏ó‡∏ô');

                // ‡∏´‡∏≤‡∏Å‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á
                currentTokenData = mockTokenDataFallback;
                isRealDataLoaded = false; // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Flag ‡πÄ‡∏õ‡πá‡∏ô false
                populateTokensTable();
                updatePortfolioOverview();
                createPortfolioChart();
                updateStatsGrid();
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô DeFi Positions
                document.getElementById('defiPositionsContent').innerHTML = `
                    <div class="position-item"><h3>üí∞ Lending Positions</h3><p class="mock-data">Aave: $0.00 supplied, $0.00 borrowed (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                    <div class="position-item"><h3>üîÑ Liquidity Pools</h3><p class="mock-data">Uniswap V3: No active positions (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                    <div class="position-item"><h3>üéØ Yield Farming</h3><p class="mock-data">Claimable Rewards: $0.00 (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                `;
            } finally {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô Dashboard ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≥‡∏•‡∏≠‡∏á
                document.getElementById('dashboard').style.display = 'grid';
                document.getElementById('tokensSection').style.display = 'block';
                document.getElementById('statsGrid').style.display = 'grid';
                document.getElementById('defiPositions').style.display = 'block';
                document.getElementById('loading').style.display = 'none';

                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                document.getElementById('lastUpdate').textContent = new Date().toLocaleString('th-TH');
            }
        }

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á Token Holdings
         */
        function populateTokensTable() {
            const tbody = document.getElementById('tokensTableBody');
            tbody.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤

            if (currentTokenData.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; color: #ccc;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Token Holdings (‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Wallet ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î)</td></tr>`;
                return;
            }

            currentTokenData.forEach(token => {
                const row = document.createElement('tr');
                const changeClass = token.change24h >= 0 ? 'change-positive' : 'change-negative';
                const changeSign = token.change24h >= 0 ? '+' : '';
                const dataSourceClass = isRealDataLoaded ? 'real-data' : 'mock-data';

                row.innerHTML = `
                    <td>
                        <img src="${token.icon}" alt="${token.symbol}" class="token-icon" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2224%22 height=%2224%22><circle cx=%2212%22 cy=%2212%22 r=%2210%22 fill=%22%23ff8c42%22/></svg>'">
                        <span class="${dataSourceClass}">${token.symbol}</span>
                    </td>
                    <td class="${dataSourceClass}">${parseFloat(token.balance).toFixed(5)}</td>
                    <td class="${dataSourceClass}">${token.price ? '$' + token.price.toFixed(2) : 'N/A'}</td>
                    <td class="${dataSourceClass}">${token.value ? '$' + token.value.toFixed(2) : 'N/A'}</td>
                    <td class="${changeClass} ${dataSourceClass}">${changeSign}${token.change24h.toFixed(2)}%</td>
                `;
                tbody.appendChild(row);
            });
        }

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° Portfolio
         */
        function updatePortfolioOverview() {
            const totalValue = currentTokenData.reduce((sum, token) => sum + token.value, 0);
            document.getElementById('portfolioValue').textContent = `$${totalValue.toFixed(2)}`;
            document.getElementById('portfolioValue').className = `portfolio-value ${isRealDataLoaded ? 'real-data' : 'mock-data'}`;

            const totalTokens = currentTokenData.length;
            document.getElementById('totalTokens').textContent = totalTokens;
            document.getElementById('totalTokens').className = isRealDataLoaded ? 'real-data' : 'mock-data';

            // ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì 24h Change ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÜ (‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏≠‡∏î‡∏µ‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥)
            let totalChangeValue = 0;
            let initialValue = 0; // ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠ 24 ‡∏ä‡∏°. ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£)
            currentTokenData.forEach(token => {
                totalChangeValue += token.value * (token.change24h / 100);
                initialValue += token.value / (1 + (token.change24h / 100)); 
            });

            const overallChangePercent = initialValue !== 0 ? (totalChangeValue / initialValue) * 100 : 0;
            const overallChangeClass = overallChangePercent >= 0 ? 'change-positive' : 'change-negative';
            const overallChangeSign = overallChangePercent >= 0 ? '+' : '';

            document.getElementById('portfolioChange').innerHTML = `
                <span class="${overallChangeClass} ${isRealDataLoaded ? 'real-data' : 'mock-data'}">
                    ${overallChangeSign}${(totalChangeValue).toFixed(2)} (${overallChangePercent.toFixed(2)}%)
                </span>
            `;
        }

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü Portfolio
         */
        function createPortfolioChart() {
            const ctx = document.getElementById('portfolioChart').getContext('2d');

            if (portfolioChart) {
                portfolioChart.destroy(); // ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
            }

            const labels = [];
            const data = [];

            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡∏à‡∏£‡∏¥‡∏á ‡∏Ñ‡∏ß‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å API (‡πÄ‡∏ä‡πà‡∏ô CoinGecko ‡∏´‡∏£‡∏∑‡∏≠ Moralis Historical Prices)
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ô‡∏≠‡∏î‡∏µ‡∏ï ‡πÇ‡∏î‡∏¢‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            const baseValue = currentTokenData.reduce((sum, token) => sum + token.value, 0);

            for (let i = 6; i >= 0; i--) { // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 7 ‡∏ß‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('th-TH', { month: 'short', day: 'numeric' }));
                const randomChange = (Math.random() - 0.5) * (baseValue * 0.05); // +/- 5% ‡∏Ç‡∏≠‡∏á‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ê‡∏≤‡∏ô
                const value = Math.max(0, baseValue + randomChange); // ‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ß‡∏Å‡πÄ‡∏™‡∏°‡∏≠
                data.push(value.toFixed(2));
            }

            portfolioChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Portfolio Value (USD)',
                        data: data,
                        borderColor: '#00d4ff',
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index',
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    }
                }
            });
        }

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏¢‡πà‡∏≠ (Stablecoins, Altcoins, etc.)
         */
        function updateStatsGrid() {
            let stablecoins = 0;
            let altcoins = 0;
            let maticDerivatives = 0; 

            currentTokenData.forEach(token => {
                const value = token.value || 0; // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ value ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤
                if (token.symbol === 'USDC' || token.symbol === 'USDT' || token.symbol === 'DAI') {
                    stablecoins += value;
                } else if (token.symbol === 'MATIC' || token.symbol === 'WMATIC') {
                    maticDerivatives += value;
                } else {
                    altcoins += value;
                }
            });

            document.getElementById('stablecoinsValue').textContent = `$${stablecoins.toFixed(2)}`;
            document.getElementById('stablecoinsValue').className = `stat-value ${isRealDataLoaded ? 'real-data' : 'mock-data'}`;

            document.getElementById('altcoinsValue').textContent = `$${altcoins.toFixed(2)}`;
            document.getElementById('altcoinsValue').className = `stat-value ${isRealDataLoaded ? 'real-data' : 'mock-data'}`;

            document.getElementById('ethDerivativesValue').textContent = `$${maticDerivatives.toFixed(2)}`;
            document.getElementById('ethDerivativesValue').className = `stat-value ${isRealDataLoaded ? 'real-data' : 'mock-data'}`;

            document.getElementById('numTokens').textContent = currentTokenData.length;
            document.getElementById('numTokens').className = `stat-value ${isRealDataLoaded ? 'real-data' : 'mock-data'}`;
        }

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• DeFi Positions ‡∏à‡∏≤‡∏Å Backend Server ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤
         * *** ‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏£‡∏≤‡∏ö: ‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• DeFi Positions ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ç‡∏≠‡∏á Alchemy (‡πÄ‡∏ä‡πà‡∏ô Portfolio API) ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Third-party API ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ***
         */
        async function fetchDeFiPositions() {
            const defiContentDiv = document.getElementById('defiPositionsContent');
            defiContentDiv.innerHTML = `<div class="loading"><div class="spinner"></div><p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• DeFi Positions...</p></div>`;

            try {
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏à‡∏≤‡∏Å Backend (Vercel Function) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á DeFi Positions
                // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡πà‡∏á wallet address ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÉ‡∏´‡πâ Backend
                const response = await fetch(`${BACKEND_URL}/api/defi-positions?address=${userAccount}`);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                let lendingHtml = '<h3>üí∞ Lending Positions</h3>';
                let lpHtml = '<h3>üîÑ Liquidity Pools</h3>';
                let farmingHtml = '<h3>üéØ Yield Farming</h3>';

                if (data.positions && data.positions.length > 0) {
                    data.positions.forEach(position => {
                        const protocolName = position.protocolName || 'Unknown Protocol';
                        const positionType = position.type || 'N/A';
                        const totalUsd = position.total_usd_value ? `$${position.total_usd_value.toFixed(2)}` : 'N/A';

                        if (positionType === 'lending') {
                            lendingHtml += `<p class="real-data">${protocolName}: ${totalUsd} supplied</p>`;
                        } else if (positionType === 'lp') {
                            lpHtml += `<p class="real-data">${protocolName}: ${totalUsd} in LP</p>`;
                        } else if (positionType === 'staking') {
                            farmingHtml += `<p class="real-data">${protocolName}: ${totalUsd} staked</p>`;
                        } else {
                            farmingHtml += `<p class="real-data">${protocolName}: ${totalUsd} (${positionType})</p>`;
                        }
                    });
                } else {
                    lendingHtml += '<p class="real-data">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Lending Positions</p>';
                    lpHtml += '<p class="real-data">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Liquidity Pools</p>';
                    farmingHtml += '<p class="real-data">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Yield Farming</p>';
                }

                defiContentDiv.innerHTML = `
                    <div class="position-item">${lendingHtml}</div>
                    <div class="position-item">${lpHtml}</div>
                    <div class="position-item">
                        ${farmingHtml}
                        <p style="font-size: 12px; color: #888; margin-top: 10px;">
                            (‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• DeFi Positions ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Alchemy Portfolio API ‡∏´‡∏£‡∏∑‡∏≠ API ‡∏≠‡∏∑‡πà‡∏ô)
                        </p>
                    </div>
                `;
            } catch (error) {
                console.error('Error fetching DeFi positions from backend:', error);
                defiContentDiv.innerHTML = `
                    <div class="position-item"><h3>üí∞ Lending Positions</h3><p class="mock-data">Aave: $0.00 supplied, $0.00 borrowed (‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                    <div class="position-item"><h3>üîÑ Liquidity Pools</h3><p class="mock-data">Uniswap V3: No active positions (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                    <div class="position-item">
                        <h3>üéØ Yield Farming</h3>
                        <p class="mock-data">Claimable Rewards: $0.00 (‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p>
                        <p style="font-size: 12px; color: #888; margin-top: 10px;">
                            (‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• DeFi Positions ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏° ‡∏´‡∏£‡∏∑‡∏≠ API ‡∏≠‡∏∑‡πà‡∏ô)
                        </p>
                    </div>
                `;
            }
        }

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏≥‡∏•‡∏≠‡∏á (‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
         */
        function updateMockPrices() {
            mockTokenDataFallback.forEach(token => { // ‡πÉ‡∏ä‡πâ mockTokenDataFallback ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
                const priceChange = (Math.random() - 0.5) * 0.02; 
                token.price = token.price * (1 + priceChange);
                token.value = parseFloat(token.balance) * token.price;
                token.change24h = (Math.random() - 0.5) * 10; 
            });
            currentTokenData = mockTokenDataFallback; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï currentTokenData ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á
            populateTokensTable();
            updatePortfolioOverview();
            createPortfolioChart(); 
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('th-TH');
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
        setInterval(() => {
            if (userAccount) { // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Wallet ‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà (‡∏à‡∏£‡∏¥‡∏á)
                loadPortfolioData();
            } else {
                updateMockPrices(); // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Wallet ‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô Mock Data ‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ
            }
        }, 30000); 

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏ô MetaMask
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', function (accounts) {
                if (accounts.length === 0) {
                    location.reload(); // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡πÉ‡∏´‡πâ Reload ‡∏´‡∏ô‡πâ‡∏≤
                } else {
                    userAccount = accounts[0];
                    document.getElementById('walletAddress').textContent = userAccount;
                    loadPortfolioData(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà
                }
            });

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Network ‡πÉ‡∏ô MetaMask
            window.ethereum.on('chainChanged', function (chainId) {
                if (Number(chainId) === 137) {
                    location.reload(); // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô Polygon Mainnet ‡πÉ‡∏´‡πâ Reload ‡∏´‡∏ô‡πâ‡∏≤
                } else {
                    alert('‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ Network ‡∏≠‡∏∑‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏µ‡πà Polygon Mainnet ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π Portfolio ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
                }
            });
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
        window.addEventListener('load', async function() {
            // ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö API Key ‡∏Ç‡∏≠‡∏á Alchemy (Frontend ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ Key ‡∏ï‡∏£‡∏á‡πÜ ‡πÅ‡∏ï‡πà‡πÑ‡∏ß‡πâ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡πÉ‡∏ô Backend)
            // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÉ‡∏ô Console ‡πÅ‡∏•‡∏∞ Alert ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå
            const alchemyApiKeyPlaceholder = "YOUR_ALCHEMY_API_KEY_GOES_HERE_IN_VERCEL_FUNCTION"; 
            if (alchemyApiKeyPlaceholder === "YOUR_ALCHEMY_API_KEY_GOES_HERE_IN_VERCEL_FUNCTION") {
                console.warn("*** ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Alchemy API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô Environment Variables ‡∏Ç‡∏≠‡∏á Vercel Function (BACKEND PROXY) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Blockchain ***");
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Alchemy API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô Environment Variables ‡∏Ç‡∏≠‡∏á Vercel Functions (‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Dashboard ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ! ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô");
            }

            // ‡πÄ‡∏û‡∏¥‡πà‡∏° Event Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° Connect MetaMask
            const connectButton = document.getElementById('connectWalletBtn');
            if (connectButton) {
                connectButton.addEventListener('click', connectWallet);
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) { // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
                        userAccount = accounts[0];
                        web3 = new Web3(window.ethereum);
                        document.getElementById('walletAddress').textContent = userAccount;
                        document.getElementById('walletInfo').style.display = 'block';
                        document.getElementById('connectWalletBtn').textContent = 'Connected ‚úÖ';
                        document.getElementById('connectWalletBtn').disabled = true;

                        const chainId = await web3.eth.getChainId();
                        if (Number(chainId) === 137) { // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô Polygon Mainnet
                            await loadPortfolioData(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á (‡∏ú‡πà‡∏≤‡∏ô Backend Proxy)
                        } else {
                            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô Polygon ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á
                            alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô Polygon Mainnet ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Network ‡πÉ‡∏ô MetaMask ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Portfolio ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
                            currentTokenData = mockTokenDataFallback;
                            isRealDataLoaded = false;
                            populateTokensTable();
                            updatePortfolioOverview();
                            createPortfolioChart();
                            updateStatsGrid();
                            document.getElementById('defiPositionsContent').innerHTML = `
                                <div class="position-item"><h3>üí∞ Lending Positions</h3><p class="mock-data">Aave: $0.00 supplied, $0.00 borrowed (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                                <div class="position-item"><h3>üîÑ Liquidity Pools</h3><p class="mock-data">Uniswap V3: No active positions (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                                <div class="position-item"><h3>üéØ Yield Farming</h3><p class="mock-data">Claimable Rewards: $0.00 (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                            `;
                            document.getElementById('dashboard').style.display = 'grid';
                            document.getElementById('tokensSection').style.display = 'block';
                            document.getElementById('statsGrid').style.display = 'grid';
                            document.getElementById('defiPositions').style.display = 'block';
                            document.getElementById('loading').style.display = 'none';
                            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('th-TH');
                        }
                    } else {
                        // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
                        currentTokenData = mockTokenDataFallback;
                        isRealDataLoaded = false;
                        populateTokensTable();
                        updatePortfolioOverview();
                        createPortfolioChart();
                        updateStatsGrid();
                        document.getElementById('defiPositionsContent').innerHTML = `
                            <div class="position-item"><h3>üí∞ Lending Positions</h3><p class="mock-data">Aave: $0.00 supplied, $0.00 borrowed (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                            <div class="position-item"><h3>üîÑ Liquidity Pools</h3><p class="mock-data">Uniswap V3: No active positions (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                            <div class="position-item"><h3>üéØ Yield Farming</h3><p class="mock-data">Claimable Rewards: $0.00 (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                        `;
                        document.getElementById('dashboard').style.display = 'grid';
                        document.getElementById('tokensSection').style.display = 'block';
                        document.getElementById('statsGrid').style.display = 'grid';
                        document.getElementById('defiPositions').style.display = 'block';
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('lastUpdate').textContent = new Date().toLocaleString('th-TH');
                    }
                } catch (err) {
                    console.error("Error checking MetaMask connection on load:", err);
                    alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ MetaMask ‡πÑ‡∏î‡πâ: " + err.message);
                }
            } else {
                // ‡∏ñ‡πâ‡∏≤ MetaMask ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
                currentTokenData = mockTokenDataFallback;
                isRealDataLoaded = false;
                populateTokensTable();
                updatePortfolioOverview();
                createPortfolioChart();
                updateStatsGrid();
                document.getElementById('defiPositionsContent').innerHTML = `
                    <div class="position-item"><h3>üí∞ Lending Positions</h3><p class="mock-data">Aave: $0.00 supplied, $0.00 borrowed (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                    <div class="position-item"><h3>üîÑ Liquidity Pools</h3><p class="mock-data">Uniswap V3: No active positions (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                    <div class="position-item"><h3>üéØ Yield Farming</h3><p class="mock-data">Claimable Rewards: $0.00 (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)</p></div>
                `;
                document.getElementById('dashboard').style.display = 'grid';
                document.getElementById('tokensSection').style.display = 'block';
                document.getElementById('statsGrid').style.display = 'grid';
                document.getElementById('defiPositions').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
                document.getElementById('lastUpdate').textContent = new Date().toLocaleString('th-TH');
            }
        });
    </script>
</body>
</html>
